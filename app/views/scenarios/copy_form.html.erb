<% content_for :config_sidebar do %>
  <%= render :partial => 'configurations/config_sidebar', :locals => {:highlighted_item => @scenario} %>
<% end %>

<h2>Copy Scenario: <%= @scenario.name %></h2>

<% form_tag(:controller => 'scenarios', :project_id => @project, :scenario_id => @scenario.id, :action => :copy_to) do %>
  <p>
    <%= label_tag :to_project %>
    <%= select_tag :to_project, options_for_select(@projects_select) %>

    <%= submit_tag 'Copy', :id => 'copy_scenario_submit' %>
  </p>
<% end %>

<script language="javascript">
var $j = jQuery;
$j(function() {
  $j('#copy_scenario_submit').click(function(the_event) {
    var redirect_url =
      '<%= edit_project_configuration_scenario_path('**P_ID**', '**ID**') %>';
    $('ajax-indicator').show();
    $j.getJSON("<%= @dbweb_db_url %>&jsoncallback=?",
               {deep: true,
                to_project: $j('#to_project option:selected').val() },
               function(data) {
                  if(data.success) {
                    var edit_url = redirect_url.replace('**ID**',data.success)
                                               .replace('**P_ID**', 
                                                        $j('#to_project option:selected').
                                                        text());
                    window.location = edit_url;
                  }
                  $('ajax-indicator').hide();
               });
    the_event.preventDefault();
  });
});
</script>
